<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>FUNNER Flip Game</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; overflow: hidden; background-color: #000; }
    body { font-family: "Microsoft JhengHei", sans-serif; display: flex; justify-content: center; align-items: center; }

    .screen {
      position: absolute; top: 0; left: 0; width: 100vw; height: 100vh;
      display: none; flex-direction: column; align-items: center;
      background-size: cover; background-position: center; background-repeat: no-repeat;
    }

    /* å•Ÿå‹•ç•«é¢ */
    #loginScreen { display: flex; z-index: 1000; background-image: url("./assets/ui/login_bg.png"); cursor: pointer; }
    .tap-hint {
      position: absolute; left: 50%; transform: translateX(-50%);
      bottom: 20%; color: #fff; font-size: 1.5rem; font-weight: bold;
      animation: blink 2s infinite; text-shadow: 2px 2px 4px #000;
    }

    /* ä¸»é¸å–® */
    #mainMenu { background-image: url("./assets/ui/main_bg.png"); }
    .play-trigger { position: absolute; top: 55%; width: 60%; height: 10%; background: rgba(0,0,0,0); cursor: pointer; }

    /* éŠæˆ²ç•«é¢ */
    #gameArea { background-color: #f4f4f4; }
    .nav-bar {
      width: 100%; height: 65px; display: flex; justify-content: space-between; align-items: center;
      padding: 0 15px; background: #fff; border-bottom: 1px solid #ddd;
    }
    .text-btn { font-size: 15px; font-weight: bold; color: #444; cursor: pointer; padding: 8px 16px; background: #f0f0f0; border-radius: 8px; border: none; }

    /* ä¿®æ­£å¾Œçš„å±…ä¸­å¡ç‰‡é™£åˆ— */
    #cardGrid {
      display: grid;
      gap: 8px; /* å›ºå®šé–“è·æ›´ç²¾ç·» */
      padding: 15px;
      width: 100vw;
      max-width: 450px;
      margin: auto; /* é—œéµç½®ä¸­ */
      justify-content: center; /* æ°´å¹³å±…ä¸­ */
      align-content: center; /* å‚ç›´å±…ä¸­ */
      flex-grow: 1;
    }

    .card { position: relative; cursor: pointer; aspect-ratio: 1 / 1; width: 100%; }
    .card-inner { width: 100%; height: 100%; transition: transform 0.5s; transform-style: preserve-3d; }
    .card.flipped .card-inner { transform: rotateY(180deg); }
    .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 12px; border: 1px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .card-back { background: url("./assets/ui/card_back.jpg") center/cover; }
    .card-front { transform: rotateY(180deg); background: #fff; overflow: hidden; }
    .card-front img { width: 100%; height: 100%; object-fit: cover; }

    /* ç¬¬äºŒé—œä¸­å¿ƒæ ¼æç¤ºæ•ˆæœ */
    .center-card { 
      cursor: default !important; 
      border: 2px dashed #bbb !important; 
      background: rgba(200, 200, 200, 0.2);
      display: flex; justify-content: center; align-items: center;
      border-radius: 12px;
      animation: pulse 2s infinite; /* å¢åŠ å‘¼å¸ç‡ˆæ•ˆæœ */
    }
    .center-card::after {
      content: "ğŸ”’"; /* é¡¯ç¤ºé–å®šåœ–ç¤º */
      font-size: 1.5rem;
      opacity: 0.5;
    }

    /* å½ˆçª—æ¨£å¼ */
    .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 5000; }
    .modal { background: #fff; padding: 35px; border-radius: 20px; text-align: center; width: 80%; }
    .modal button { margin-top: 20px; padding: 12px 35px; background: #007AFF; color: white; border: none; border-radius: 10px; font-size: 1.1rem; }

    @keyframes blink { 0% { opacity: 0.3; } 50% { opacity: 1; } 100% { opacity: 0.3; } }
    @keyframes pulse { 0% { background: rgba(200,200,200,0.1); } 50% { background: rgba(255,255,255,0.6); } 100% { background: rgba(200,200,200,0.1); } }
  </style>
</head>
<body>

  <div id="loginScreen" class="screen" onclick="gotoMenu()"><div class="tap-hint">TAP TO START</div></div>
  <div id="mainMenu" class="screen"><div class="play-trigger" onclick="gotoGame()"></div></div>

  <div id="gameArea" class="screen">
    <div class="nav-bar">
      <button class="text-btn" onclick="backToMenu()">è¿”å›</button>
      <div style="font-weight:bold; font-size:1.1rem;">LEVEL <span id="lvText">1</span></div>
      <button class="text-btn" onclick="initLevel()">é‡ç½®</button>
    </div>
    <div id="cardGrid"></div>
    <div style="padding-bottom: 25px; color: #888; font-weight: bold;">STEPS: <span id="stText">0</span></div>
  </div>

  <div id="winOverlay" class="overlay">
    <div class="modal"><h2 id="winMsg">CLEAR!</h2><p style="margin:10px 0;">æ­¥æ•¸ï¼š<span id="finalSt">0</span></p><button onclick="nextLevel()">NEXT LEVEL</button></div>
  </div>

  <audio id="bgm" src="./assets/audio/theme.mp3" loop></audio>

  <script>
    let lv = 1, st = 0, matched = 0, flipped = [], lock = false;
    const fishImgs = Array.from({length: 18}, (_, i) => `./assets/cards/${i+1}.jpg`);

    function gotoMenu() {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('mainMenu').style.display = 'flex';
      document.getElementById('bgm').play().catch(() => {});
    }

    function backToMenu() {
      if(confirm("ç¢ºå®šè¿”å›ä¸»é¸å–®ï¼Ÿ")) {
        document.getElementById('gameArea').style.display = 'none';
        document.getElementById('mainMenu').style.display = 'flex';
      }
    }

    function gotoGame() {
      document.getElementById('mainMenu').style.display = 'none';
      document.getElementById('gameArea').style.display = 'flex';
      lv = 1; initLevel();
    }

    function initLevel() {
      const grid = document.getElementById('cardGrid');
      grid.innerHTML = '';
      st = 0; matched = 0; flipped = []; lock = false;
      document.getElementById('stText').textContent = st;
      document.getElementById('lvText').textContent = lv;

      let size = (lv === 1) ? 4 : (lv === 2 ? 5 : 6);
      let totalCells = size * size;
      let pairsNeeded = (lv === 2) ? (totalCells - 1) / 2 : totalCells / 2;

      let deck = [...fishImgs].sort(() => 0.5 - Math.random()).slice(0, pairsNeeded);
      deck = [...deck, ...deck].sort(() => 0.5 - Math.random());

      grid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;

      for (let i = 0; i < totalCells; i++) {
        const card = document.createElement('div');
        if (lv === 2 && i === 12) {
          card.className = 'card center-card';
          grid.appendChild(card);
          continue;
        }

        card.className = 'card';
        const src = deck.pop();
        card.innerHTML = `
          <div class="card-inner">
            <div class="card-face card-back"></div>
            <div class="card-face card-front"><img src="${src}" style="width:100%; height:100%; object-fit:cover;"></div>
          </div>
        `;

        card.onclick = () => {
          if (lock || card.classList.contains('flipped')) return;
          card.classList.add('flipped');
          flipped.push({ card, src });
          if (flipped.length === 2) {
            st++; document.getElementById('stText').textContent = st;
            lock = true;
            if (flipped[0].src === flipped[1].src) {
              matched++; flipped = []; lock = false;
              if (matched === pairsNeeded) setTimeout(showWin, 500);
            } else {
              setTimeout(() => {
                flipped.forEach(f => f.card.classList.remove('flipped'));
                flipped = []; lock = false;
              }, 800);
            }
          }
        };
        grid.appendChild(card);
      }
    }

    function showWin() {
      document.getElementById('finalSt').textContent = st;
      document.getElementById('winOverlay').style.display = 'flex';
      if(lv === 3) document.getElementById('winMsg').textContent = "ALL CLEAR!";
    }

    function nextLevel() {
      document.getElementById('winOverlay').style.display = 'none';
      if (lv < 3) { lv++; initLevel(); } 
      else { 
        document.getElementById('gameArea').style.display = 'none';
        document.getElementById('mainMenu').style.display = 'flex';
      }
    }
  </script>
</body>
</html>